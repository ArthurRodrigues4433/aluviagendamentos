<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="https://public-frontend-cos.metadl.com/mgx/img/favicon.png" type="image/png">
    <title>Dashboard Administrador - SaaS Agendamento</title>
    <link rel="stylesheet" href="/frontend/assets/styles.css">
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <nav class="nav">
                <a href="dashboard-admin.html" class="logo">Aluvi Admin</a>
                <ul class="nav-links">
                    <li><a href="#" id="logoutBtn">Sair</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <!-- Navigation Tabs -->
        <div class="card mb-3">
            <div class="d-flex gap-1" style="flex-wrap: wrap;">
                <button class="btn btn-primary tab-btn active" data-tab="dashboard">Dashboard</button>
                <button class="btn btn-outline tab-btn" data-tab="owners">Criar Novo Dono</button>
                <button class="btn btn-outline tab-btn" data-tab="salons">Gerenciar Sal√µes</button>
                <button class="btn btn-outline tab-btn" data-tab="company-settings">Editar Info Empresas</button>
                <button class="btn btn-outline tab-btn" data-tab="subscriptions">Mensalidades</button>
                <button class="btn btn-outline tab-btn" data-tab="reports">Relat√≥rios</button>
            </div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboardTab" class="tab-content active">
            <h2 class="mb-2">Vis√£o Geral do Sistema</h2>

            <div id="adminStatsGrid" class="stats-grid">
                <div class="loading">Carregando estat√≠sticas...</div>
            </div>

            <!-- Sal√µes Recentes -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Sal√µes Recentes</h3>
                </div>
                <div id="recentSalons">
                    <div class="loading">Carregando sal√µes...</div>
                </div>
            </div>

            <!-- Alertas de Sistema -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Alertas do Sistema</h3>
                </div>
                <div id="systemAlerts">
                    <div class="alert alert-info">
                        <p>Sistema funcionando normalmente</p>
                        <button class="btn btn-secondary btn-sm" onclick="testRealtimeUpdate()" style="margin-top: 10px;">
                            üß™ Testar Atualiza√ß√£o em Tempo Real
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Owners Management Tab -->
        <div id="ownersTab" class="tab-content">
            <div class="d-flex justify-between align-center mb-2">
                <h2>Gerenciar Donos de Sal√£o</h2>
                <button class="btn btn-primary" id="addOwnerBtn">Criar Novo Dono</button>
            </div>

            <div class="card">
                <div id="ownersList">
                    <div class="loading">Carregando donos...</div>
                </div>
            </div>
        </div>

        <!-- Salons Management Tab -->
        <div id="salonsTab" class="tab-content">
            <div class="d-flex justify-between align-center mb-2">
                <h2>Gerenciar Sal√µes</h2>
                <button class="btn btn-primary" id="addSalonBtn">Criar Novo Sal√£o</button>
            </div>

            <div class="card">
                <div id="salonsList">
                    <div class="loading">Carregando sal√µes...</div>
                </div>
            </div>
        </div>

        <!-- Company Settings Tab -->
        <div id="companySettingsTab" class="tab-content">
            <h2 class="mb-2">Configura√ß√µes da Empresa</h2>

            <!-- Instructions -->
            <div class="alert alert-info mb-3">
                <strong>Como usar:</strong> Digite o nome da empresa no campo abaixo para buscar e selecionar uma empresa. Ap√≥s selecionar, voc√™ poder√° editar todas as configura√ß√µes da empresa.
            </div>

            <!-- Company Selection -->
            <div class="card mb-3">
                <div class="form-group">
                    <label class="form-label">Selecionar Empresa</label>
                    <div class="d-flex gap-1">
                        <input type="text" id="companySearch" class="form-control" placeholder="Digite o nome da empresa..." style="flex: 1;">
                        <button class="btn btn-outline" id="searchCompaniesBtn">üîç Buscar</button>
                    </div>
                    <div id="companiesList" class="mt-2" style="display: none; max-height: 200px; overflow-y: auto; border: 1px solid #ddd; border-radius: 0.25rem;">
                        <!-- Lista de empresas ser√° inserida dinamicamente -->
                    </div>
                </div>
            </div>

            <!-- Company Settings Content -->
            <div id="companySettingsContent" style="display: none;">
                <!-- Sub-tabs for Company Settings -->
                <div class="card mb-3">
                    <div class="d-flex gap-1" style="flex-wrap: wrap;">
                        <button class="btn btn-primary company-sub-tab-btn active" data-sub-tab="basic-info">Informa√ß√µes B√°sicas</button>
                        <button class="btn btn-outline company-sub-tab-btn" data-sub-tab="appearance">Apar√™ncia do Card</button>
                        <button class="btn btn-outline company-sub-tab-btn" data-sub-tab="owner-info">Informa√ß√µes do Dono</button>
                        <button class="btn btn-outline company-sub-tab-btn" data-sub-tab="sharing">Compartilhar</button>
                    </div>
                </div>

                <!-- Basic Info Sub-tab -->
                <div id="basic-infoSubTab" class="company-sub-tab-content active">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Informa√ß√µes B√°sicas da Empresa</h3>
                        </div>

                        <form id="adminCompanyBasicForm">
                            <div class="grid grid-2">
                                <div class="form-group">
                                    <label class="form-label">Nome da Empresa *</label>
                                    <input type="text" id="adminCompanyName" class="form-control" required placeholder="Ex: Barbearia do Jo√£o">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Telefone</label>
                                    <input type="tel" id="adminCompanyPhone" class="form-control" placeholder="(11) 99999-9999">
                                </div>
                            </div>

                            <div class="grid grid-2">
                                <div class="form-group">
                                    <label class="form-label">Rua e N√∫mero</label>
                                    <input type="text" id="adminCompanyStreet" class="form-control" placeholder="Ex: Rua das Flores, 123">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Bairro/Regi√£o</label>
                                    <input type="text" id="adminCompanyNeighborhood" class="form-control" placeholder="Ex: Centro, S√£o Paulo">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Descri√ß√£o (opcional)</label>
                                <textarea id="adminCompanyDescription" class="form-control" rows="3" placeholder="Descreva seu neg√≥cio, especialidades, etc."></textarea>
                            </div>

                            <div class="d-flex gap-1 mt-3">
                                <button type="submit" class="btn btn-primary">Salvar Informa√ß√µes B√°sicas</button>
                                <button type="button" class="btn btn-secondary" id="adminLoadCompanyBasic">Carregar Dados</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Appearance Sub-tab -->
                <div id="appearanceSubTab" class="company-sub-tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Apar√™ncia do Card para Clientes</h3>
                        </div>

                        <form id="adminCompanyAppearanceForm">
                            <div class="alert alert-info mb-3">
                                <strong>Preview:</strong> Configure como seu sal√£o aparecer√° para os clientes na p√°gina de sele√ß√£o.
                            </div>

                            <div class="form-group">
                                <label class="form-label">Nome no Card</label>
                                <input type="text" id="adminCardDisplayName" class="form-control" placeholder="Nome que aparecer√° no card" readonly>
                                <small class="text-muted">Ser√° preenchido automaticamente com o nome da empresa</small>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Localiza√ß√£o no Card</label>
                                <input type="text" id="adminCardLocation" class="form-control" placeholder="Ex: Centro, S√£o Paulo" readonly>
                                <small class="text-muted">Ser√° preenchido automaticamente com o bairro/regi√£o definido nas Informa√ß√µes B√°sicas</small>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Logo/Foto do Sal√£o</label>
                                <div class="d-flex gap-1 align-center">
                                    <input type="file" id="adminCompanyLogo" class="form-control" accept="image/*" style="flex: 1;">
                                    <button type="button" class="btn btn-outline" id="adminUploadLogo" disabled>Upload</button>
                                </div>
                                <small class="text-muted">Formato: JPG, PNG. Tamanho m√°ximo: 2MB</small>
                                <div id="adminLogoPreview" class="mt-2" style="display: none;">
                                    <img id="adminLogoImage" src="" alt="Logo Preview" style="max-width: 200px; max-height: 150px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Descri√ß√£o Curta</label>
                                <textarea id="adminCardDescription" class="form-control" rows="2" maxlength="150" placeholder="Descri√ß√£o breve que aparecer√° no card"></textarea>
                                <small class="text-muted">M√°ximo 150 caracteres</small>
                            </div>

                            <div class="d-flex gap-1 mt-3">
                                <button type="submit" class="btn btn-primary">Salvar Apar√™ncia</button>
                                <button type="button" class="btn btn-secondary" id="adminLoadCompanyAppearance">Carregar Dados</button>
                            </div>
                        </form>
                    </div>

                    <!-- Live Preview -->
                    <div class="card mt-3">
                        <div class="card-header">
                            <h3 class="card-title">Preview do Card</h3>
                        </div>
                        <div id="adminCardPreview" class="company-card-preview">
                            <!-- Preview ser√° gerado dinamicamente -->
                        </div>
                    </div>
                </div>

                <!-- Owner Info Sub-tab -->
                <div id="owner-infoSubTab" class="company-sub-tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Informa√ß√µes do Dono</h3>
                        </div>

                        <form id="adminCompanyOwnerForm">
                            <div class="alert alert-info mb-3">
                                <strong>Informa√ß√µes Pessoais:</strong> Estas informa√ß√µes podem aparecer no perfil do sal√£o.
                            </div>

                            <div class="grid grid-2">
                                <div class="form-group">
                                    <label class="form-label">Nome do Dono</label>
                                    <input type="text" id="adminOwnerName" class="form-control" placeholder="Nome da pessoa respons√°vel">
                                    <small class="text-muted">Pessoa respons√°vel pelo neg√≥cio</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Telefone Pessoal</label>
                                    <input type="tel" id="adminOwnerPersonalPhone" class="form-control" placeholder="(11) 99999-9999" readonly>
                                    <small class="text-muted">Ser√° replicado do telefone da empresa</small>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">E-mail de Contato</label>
                                <input type="email" id="adminOwnerEmail" class="form-control" placeholder="seu@email.com" readonly>
                                <small class="text-muted">Vem do perfil de usu√°rio</small>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Experi√™ncia/Especialidades</label>
                                <textarea id="adminOwnerExperience" class="form-control" rows="3" placeholder="Conte um pouco sobre sua experi√™ncia e especialidades"></textarea>
                            </div>

                            <div class="d-flex gap-1 mt-3">
                                <button type="submit" class="btn btn-primary">Salvar Informa√ß√µes do Dono</button>
                                <button type="button" class="btn btn-secondary" id="adminLoadCompanyOwner">Carregar Dados</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Sharing Sub-tab -->
                <div id="sharingSubTab" class="company-sub-tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Compartilhar Sal√£o</h3>
                        </div>

                        <div class="alert alert-info mb-3">
                            <strong>Compartilhe este link:</strong> Use este link √∫nico para direcionar seus clientes diretamente para a sele√ß√£o do seu sal√£o.
                        </div>

                        <div class="form-group">
                            <label class="form-label">Link de Agendamento</label>
                            <div class="d-flex gap-1">
                                <input type="text" id="adminCompanyShareLink" class="form-control" readonly>
                                <button class="btn btn-outline" id="adminCopyShareLink" title="Copiar link">
                                    üìã Copiar
                                </button>
                            </div>
                            <small class="text-muted">Este link leva diretamente para a sele√ß√£o do seu sal√£o</small>
                        </div>

                        <div class="form-group">
                            <label class="form-label">C√≥digo QR (em breve)</label>
                            <div class="alert alert-warning">
                                <strong>Em desenvolvimento:</strong> Em breve voc√™ poder√° gerar um c√≥digo QR para compartilhar fisicamente.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mensagens -->
            <div id="adminCompanyProfileMessages"></div>
        </div>

        <!-- Subscriptions Tab -->
        <div id="subscriptionsTab" class="tab-content">
            <h2 class="mb-2">Gest√£o de Mensalidades</h2>

            <!-- Filtros -->
            <div class="card mb-3">
                <div class="form-group">
                    <label class="form-label">Filtros</label>
                    <div class="grid grid-3">
                        <div>
                            <label>Status</label>
                            <select id="subscriptionFilter" class="form-control form-select">
                                <option value="">Todos</option>
                                <option value="paid">Em Dia</option>
                                <option value="pending">Pendente</option>
                                <option value="overdue">Vencido</option>
                            </select>
                        </div>
                        <div>
                            <label>Dias para Vencimento</label>
                            <select id="daysFilter" class="form-control form-select">
                                <option value="">Todos</option>
                                <option value="7">At√© 7 dias</option>
                                <option value="30">At√© 30 dias</option>
                                <option value="expired">Vencidos</option>
                            </select>
                        </div>
                        <div class="d-flex gap-1">
                            <button class="btn btn-primary" id="applySubscriptionFilters">Aplicar</button>
                            <button class="btn btn-secondary" id="clearSubscriptionFilters">Limpar</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div id="subscriptionsList">
                    <div class="loading">Carregando mensalidades...</div>
                </div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reportsTab" class="tab-content">
            <h2 class="mb-2">Relat√≥rios Administrativos</h2>

            <div class="grid grid-2 mb-3">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Crescimento de Sal√µes</h3>
                    </div>
                    <div class="form-group">
                        <select id="growthPeriod" class="form-control form-select">
                            <option value="monthly">Mensal</option>
                            <option value="quarterly">Trimestral</option>
                            <option value="yearly">Anual</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" id="generateGrowthReport">Gerar Relat√≥rio</button>
                    <div id="growthReportResult" class="mt-2"></div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Receita Total</h3>
                    </div>
                    <div class="form-group">
                        <select id="revenuePeriod" class="form-control form-select">
                            <option value="monthly">Mensal</option>
                            <option value="quarterly">Trimestral</option>
                            <option value="yearly">Anual</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" id="generateRevenueReport">Gerar Relat√≥rio</button>
                    <div id="revenueReportResult" class="mt-2"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal para CRUD de Sal√£o -->
    <div id="salonModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="salonModalTitle">Criar Sal√£o</h3>
                <button class="modal-close" id="closeSalonModal">&times;</button>
            </div>
            <form id="salonForm">
                <div id="salonModalBody">
                    <div class="form-group">
                        <label for="salonName" class="form-label">Nome do Sal√£o</label>
                        <input type="text" id="salonName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="salonEmail" class="form-label">Email (opcional - ser√° gerado automaticamente se vazio)</label>
                        <input type="email" id="salonEmail" class="form-control">
                    </div>
                </div>
                <div class="d-flex gap-1 mt-2">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Salvar</button>
                    <button type="button" class="btn btn-secondary" id="cancelSalonModal" style="flex: 1;">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Criar Dono -->
    <div id="ownerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="ownerModalTitle">Criar Novo Dono</h3>
                <button class="modal-close" id="closeOwnerModal">&times;</button>
            </div>
            <form id="ownerForm">
                <div id="ownerModalBody">
                    <div class="form-group">
                        <label for="ownerName" class="form-label">Nome do Dono</label>
                        <input type="text" id="ownerName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="ownerEmail" class="form-label">Email do Dono</label>
                        <input type="email" id="ownerEmail" class="form-control" required>
                        <small class="text-muted">Ser√° usado como login e para enviar as credenciais</small>
                    </div>
                </div>
                <div class="d-flex gap-1 mt-2">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Criar Dono</button>
                    <button type="button" class="btn btn-secondary" id="cancelOwnerModal" style="flex: 1;">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Gest√£o de Mensalidade -->
    <div id="subscriptionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Gerenciar Mensalidade</h3>
                <button class="modal-close" id="closeSubscriptionModal">&times;</button>
            </div>
            <form id="subscriptionForm">
                <div id="subscriptionModalBody">
                    <div class="form-group">
                        <label class="form-label">Sal√£o: <span id="subscriptionSalonName"></span></label>
                    </div>
                    <div class="form-group">
                        <label for="paymentStatus" class="form-label">Status do Pagamento</label>
                        <select id="paymentStatus" class="form-control form-select" required>
                            <option value="true">Pago</option>
                            <option value="false">Pendente</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="dueDate" class="form-label">Nova Data de Vencimento</label>
                        <input type="date" id="dueDate" class="form-control" required>
                    </div>
                </div>
                <div class="d-flex gap-1 mt-2">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Atualizar</button>
                    <button type="button" class="btn btn-secondary" id="cancelSubscriptionModal" style="flex: 1;">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/frontend/config.js"></script>
    <script src="/frontend/app.js"></script>
    <script src="/frontend/services/dashboard-realtime.js"></script>
    <script>
        // Vari√°veis globais
        let currentTab = 'dashboard';
        let currentSalonId = null;
        let selectedCompanyId = null;
        let selectedCompanyData = null;

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ DOMContentLoaded - Iniciando dashboard admin');

            // Verificar autentica√ß√£o de admin
            if (!AuthGuard.requireAuth(['admin'])) return;

            // Inicializar interface
            initializeTabs();
            setupEventListeners();
            loadAdminDashboard();

            console.log('‚úÖ Dashboard admin inicializado');
        });

        // Inicializar sistema de abas
        function initializeTabs() {
            console.log('Inicializando sistema de abas...');

            // Esconder todas as abas inicialmente
            const allTabs = document.querySelectorAll('.tab-content');
            allTabs.forEach(tab => {
                if (tab) {
                    tab.style.display = 'none';
                    tab.classList.remove('active');
                }
            });

            // Mostrar apenas a aba do dashboard
            const dashboardTab = document.getElementById('dashboardTab');
            if (dashboardTab) {
                dashboardTab.style.display = 'block';
                dashboardTab.classList.add('active');
                console.log('Aba dashboard inicializada como ativa');
            }

            // Configurar bot√£o ativo inicial
            const dashboardButton = document.querySelector('[data-tab="dashboard"]');
            if (dashboardButton) {
                dashboardButton.className = 'btn btn-primary tab-btn active';
            }
        }

        // Configurar event listeners
        function setupEventListeners() {
            // Logout
            document.getElementById('logoutBtn').addEventListener('click', () => api.logout());

            // Tabs
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => switchTab(btn.dataset.tab));
            });

            // Modais
            document.getElementById('closeOwnerModal').addEventListener('click', closeOwnerModal);
            document.getElementById('cancelOwnerModal').addEventListener('click', closeOwnerModal);
            document.getElementById('closeSalonModal').addEventListener('click', closeSalonModal);
            document.getElementById('cancelSalonModal').addEventListener('click', closeSalonModal);
            document.getElementById('closeSubscriptionModal').addEventListener('click', closeSubscriptionModal);
            document.getElementById('cancelSubscriptionModal').addEventListener('click', closeSubscriptionModal);

            // CRUD buttons
            document.getElementById('addOwnerBtn').addEventListener('click', () => openOwnerModal());
            document.getElementById('addSalonBtn').addEventListener('click', () => openSalonModal());

            // Forms
            document.getElementById('ownerForm').addEventListener('submit', handleOwnerSubmit);
            document.getElementById('salonForm').addEventListener('submit', handleSalonSubmit);
            document.getElementById('subscriptionForm').addEventListener('submit', handleSubscriptionSubmit);

            // Reports
            document.getElementById('generateGrowthReport').addEventListener('click', generateGrowthReport);
            document.getElementById('generateRevenueReport').addEventListener('click', generateRevenueReport);

            // Filters
            document.getElementById('applySubscriptionFilters').addEventListener('click', loadSubscriptions);
            document.getElementById('clearSubscriptionFilters').addEventListener('click', clearSubscriptionFilters);

            // Company Settings
            document.getElementById('companySearch').addEventListener('input', searchCompanies);
            document.getElementById('searchCompaniesBtn').addEventListener('click', searchCompanies);
            document.querySelectorAll('.company-sub-tab-btn').forEach(btn => {
                btn.addEventListener('click', () => switchCompanySubTab(btn.dataset.subTab));
            });

            // Company Settings Forms
            document.getElementById('adminCompanyBasicForm').addEventListener('submit', handleAdminCompanyBasicSubmit);
            document.getElementById('adminLoadCompanyBasic').addEventListener('click', loadAdminCompanyBasic);

            document.getElementById('adminCompanyAppearanceForm').addEventListener('submit', handleAdminCompanyAppearanceSubmit);
            document.getElementById('adminLoadCompanyAppearance').addEventListener('click', loadAdminCompanyAppearance);
            document.getElementById('adminCompanyLogo').addEventListener('change', handleAdminLogoPreview);
            document.getElementById('adminUploadLogo').addEventListener('click', handleAdminLogoUpload);

            document.getElementById('adminCompanyOwnerForm').addEventListener('submit', handleAdminCompanyOwnerSubmit);
            document.getElementById('adminLoadCompanyOwner').addEventListener('click', loadAdminCompanyOwner);

            document.getElementById('adminCopyShareLink').addEventListener('click', copyAdminShareLink);
        }

        // Alternar entre tabs
        function switchTab(tabName) {
            console.log(`üîÑ Trocando para aba: ${tabName}`);

            // Esconder todas as abas
            const allTabContents = document.querySelectorAll('.tab-content');
            allTabContents.forEach(content => {
                if (content) {
                    content.style.display = 'none';
                    content.classList.remove('active');
                }
            });

            // Remover classe active de todos os bot√µes
            const allTabButtons = document.querySelectorAll('.tab-btn');
            allTabButtons.forEach(btn => {
                if (btn) {
                    btn.className = 'btn btn-outline tab-btn';
                }
            });

            // Ativar bot√£o clicado
            const activeButton = document.querySelector(`[data-tab="${tabName}"]`);
            if (activeButton) {
                activeButton.className = 'btn btn-primary tab-btn active';
            }

            // Mostrar aba selecionada
            const targetTab = document.getElementById(tabName + 'Tab');
            if (targetTab) {
                targetTab.style.display = 'block';
                targetTab.classList.add('active');
                console.log(`[TAB_SWITCH] Aba ${tabName} ativada - display:`, targetTab.style.display, 'class:', targetTab.className);
            } else {
                console.error(`[TAB_SWITCH] Aba ${tabName} n√£o encontrada no DOM`);
            }

            currentTab = tabName;
            console.log(`üìù currentTab definido como: ${currentTab}`);

            // Carregar dados da tab
            console.log(`[TAB_SWITCH] üîÑ Carregando dados para aba: ${tabName}`);
            switch(tabName) {
                case 'dashboard':
                    console.log('[TAB_SWITCH] üìä Chamando loadAdminDashboard()');
                    loadAdminDashboard();
                    break;
                case 'owners':
                    console.log('[TAB_SWITCH] üë• Chamando loadOwners()');
                    loadOwners();
                    break;
                case 'salons':
                    console.log('[TAB_SWITCH] üè™ Chamando loadSalons()');
                    loadSalons();
                    break;
                case 'subscriptions':
                    console.log('[TAB_SWITCH] üí∞ Chamando loadSubscriptions()');
                    loadSubscriptions();
                    break;
                case 'company-settings':
                    console.log('[TAB_SWITCH] üè¢ Iniciando aba empresa...');
                    // Aguardar um pouco para garantir que a aba est√° vis√≠vel antes de inicializar
                    setTimeout(() => {
                        initializeCompanySettings();
                    }, 100);
                    break;
                case 'reports':
                    console.log('[TAB_SWITCH] üìà Relat√≥rios carregados sob demanda');
                    // Relat√≥rios carregados sob demanda
                    break;
            }
        }

        // Carregar dashboard admin
        async function loadAdminDashboard() {
            try {
                console.log('[ADMIN] üîÑ Carregando dashboard...');

                // Carregar estat√≠sticas gerais
                        const statsResponse = await api.request('/salons/admin/subscriptions');
                        console.log('[ADMIN] üìä Resposta da API para estat√≠sticas:', statsResponse);
                        if (statsResponse.success) {
                            console.log('[ADMIN] ‚úÖ Estat√≠sticas carregadas:', statsResponse.subscriptions.length, 'sal√µes');
                            console.log('[ADMIN] üìã Dados dos sal√µes:', statsResponse.subscriptions);
                            displayAdminStats(statsResponse.subscriptions);
                            console.log('[ADMIN] üîÑ Removendo indicador de loading das estat√≠sticas...');
                            UI.hideLoading(document.getElementById('adminStatsGrid'));
                        } else {
                            console.log('[ADMIN] ‚ùå Falha ao carregar estat√≠sticas:', statsResponse);
                        }

                // Carregar sal√µes recentes
                await loadRecentSalons();

                console.log('[ADMIN] ‚úÖ Dashboard carregado com sucesso');

            } catch (error) {
                console.error('[ADMIN] ‚ùå Erro ao carregar dashboard:', error);
                UI.showError('Erro ao carregar dados do dashboard');
            }
        }

        // Exibir estat√≠sticas do admin
        function displayAdminStats(subscriptions) {
            console.log('[ADMIN] üìä Exibindo estat√≠sticas para', subscriptions.length, 'sal√µes');
            const statsGrid = document.getElementById('adminStatsGrid');

            // Calcular estat√≠sticas
            const totalSalons = subscriptions.length;
            const activeSalons = subscriptions.filter(s => s.ativo).length;
            const paidSubscriptions = subscriptions.filter(s => s.mensalidade_pago).length;
            const pendingSubscriptions = totalSalons - paidSubscriptions;

            console.log('[ADMIN] üìà Estat√≠sticas calculadas:', {
                totalSalons,
                activeSalons,
                paidSubscriptions,
                pendingSubscriptions
            });

            // Calcular receita mensal estimada (R$ 99 por sal√£o pago)
            const monthlyRevenue = paidSubscriptions * 99;

            const newHtml = `
                <div class="stat-card">
                    <div class="stat-number">${totalSalons}</div>
                    <div class="stat-label">Total de Sal√µes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${activeSalons}</div>
                    <div class="stat-label">Sal√µes Ativos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${paidSubscriptions}</div>
                    <div class="stat-label">Mensalidades Pagas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${pendingSubscriptions}</div>
                    <div class="stat-label">Mensalidades Pendentes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">R$ ${monthlyRevenue.toLocaleString('pt-BR')}</div>
                    <div class="stat-label">Receita Mensal Estimada</div>
                </div>
            `;
            console.log('[ADMIN] üìä HTML das estat√≠sticas gerado:', newHtml);
            statsGrid.innerHTML = newHtml;
            console.log('[ADMIN] ‚úÖ HTML das estat√≠sticas aplicado ao DOM');
        }

        // Carregar sal√µes recentes
        async function loadRecentSalons() {
            try {
                console.log('[ADMIN] üîÑ Carregando sal√µes recentes...');
                const response = await api.request('/salons/admin/subscriptions');
                console.log('[ADMIN] üìä Resposta para sal√µes recentes:', response);
                if (response.success) {
                    const recentSalons = response.subscriptions
                        .sort((a, b) => new Date(b.created_at || 0) - new Date(a.created_at || 0))
                        .slice(0, 5);

                    console.log('[ADMIN] ‚úÖ Sal√µes recentes ordenados:', recentSalons.length, 'itens');
                    displayRecentSalons(recentSalons);
                    console.log('[ADMIN] üîÑ Removendo indicador de loading dos sal√µes recentes...');
                    UI.hideLoading(document.getElementById('recentSalons'));
                } else {
                    console.log('[ADMIN] ‚ùå Falha ao carregar sal√µes recentes:', response);
                }
            } catch (error) {
                console.error('[ADMIN] Erro ao carregar sal√µes recentes:', error);
            }
        }

        // Exibir sal√µes recentes
        function displayRecentSalons(salons) {
            console.log('[ADMIN] üìã Exibindo sal√µes recentes:', salons);
            const container = document.getElementById('recentSalons');

            if (!salons || salons.length === 0) {
                console.log('[ADMIN] ‚ö†Ô∏è Nenhum sal√£o recente para exibir');
                container.innerHTML = '<p class="text-center">Nenhum sal√£o cadastrado ainda.</p>';
                return;
            }

            let html = '<div class="table-responsive"><table class="table">';
            html += '<thead><tr><th>Nome</th><th>Email</th><th>Status</th><th>Mensalidade</th></tr></thead>';
            html += '<tbody>';

            salons.forEach(salon => {
                const statusClass = salon.ativo ? 'badge-success' : 'badge-danger';
                const statusText = salon.ativo ? 'Ativo' : 'Inativo';
                const paymentClass = salon.mensalidade_pago ? 'badge-success' : 'badge-danger';
                const paymentText = salon.mensalidade_pago ? 'Pago' : 'Pendente';

                html += `
                    <tr>
                        <td>${salon.nome}</td>
                        <td>${salon.email}</td>
                        <td><span class="badge ${statusClass}">${statusText}</span></td>
                        <td><span class="badge ${paymentClass}">${paymentText}</span></td>
                    </tr>
                `;
            });

            html += '</tbody></table></div>';
            console.log('[ADMIN] üìä HTML dos sal√µes recentes gerado:', html);
            container.innerHTML = html;
            console.log('[ADMIN] ‚úÖ HTML dos sal√µes recentes aplicado ao DOM');
        }

        // Carregar lista de sal√µes
        async function loadSalons() {
            try {
                console.log('[ADMIN] üîÑ Carregando lista de sal√µes...');
                UI.showLoading(document.getElementById('salonsList'));

                const response = await api.request('/salons/admin/subscriptions');
                console.log('[ADMIN] üìä Resposta da API para lista de sal√µes:', response);
                if (response.success) {
                    console.log('[ADMIN] ‚úÖ Sal√µes carregados:', response.subscriptions.length, 'itens');
                    console.log('[ADMIN] üìã Dados dos sal√µes:', response.subscriptions);
                    displaySalonsList(response.subscriptions);
                } else {
                    console.log('[ADMIN] ‚ùå Falha na resposta da API para sal√µes:', response);
                    throw new Error('Erro ao carregar sal√µes');
                }
            } catch (error) {
                console.error('[ADMIN] ‚ùå Erro ao carregar sal√µes:', error);
                document.getElementById('salonsList').innerHTML = '<div class="alert alert-error">Erro ao carregar sal√µes</div>';
            }
        }

        // Exibir lista de sal√µes
        function displaySalonsList(salons) {
            const container = document.getElementById('salonsList');

            if (!salons || salons.length === 0) {
                container.innerHTML = '<p class="text-center">Nenhum sal√£o cadastrado.</p>';
                return;
            }

            let html = '<div class="table-responsive"><table class="table">';
            html += '<thead><tr><th>Nome</th><th>Email</th><th>Status</th><th>Mensalidade</th><th>Vencimento</th><th>A√ß√µes</th></tr></thead>';
            html += '<tbody>';

            salons.forEach(salon => {
                const statusClass = salon.ativo ? 'badge-success' : 'badge-danger';
                const statusText = salon.ativo ? 'Ativo' : 'Inativo';
                const paymentClass = salon.mensalidade_pago ? 'badge-success' : 'badge-danger';
                const paymentText = salon.mensalidade_pago ? 'Pago' : 'Pendente';
                const dueDate = salon.data_vencimento_mensalidade ?
                    new Date(salon.data_vencimento_mensalidade).toLocaleDateString('pt-BR') : 'N/A';

                html += `
                    <tr>
                        <td>${salon.nome}</td>
                        <td>${salon.email}</td>
                        <td><span class="badge ${statusClass}">${statusText}</span></td>
                        <td><span class="badge ${paymentClass}">${paymentText}</span></td>
                        <td>${dueDate}</td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="manageSubscription(${salon.id}, '${salon.nome}')">
                                Gerenciar
                            </button>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        // Carregar mensalidades
        async function loadSubscriptions() {
            try {
                console.log('[ADMIN] üîÑ Carregando mensalidades...');
                UI.showLoading(document.getElementById('subscriptionsList'));

                const response = await api.request('/salons/admin/subscriptions');
                console.log('[ADMIN] üìä Resposta da API para mensalidades:', response);
                if (response.success) {
                    console.log('[ADMIN] ‚úÖ Mensalidades carregadas:', response.subscriptions.length, 'itens');
                    console.log('[ADMIN] üìã Dados das mensalidades:', response.subscriptions);
                    let filteredSubscriptions = response.subscriptions;

                    // Aplicar filtros
                    const statusFilter = document.getElementById('subscriptionFilter').value;
                    const daysFilter = document.getElementById('daysFilter').value;

                    console.log('[ADMIN] üìä Aplicando filtros - Status:', statusFilter, 'Dias:', daysFilter);

                    if (statusFilter) {
                        const isPaid = statusFilter === 'paid';
                        filteredSubscriptions = filteredSubscriptions.filter(s => s.mensalidade_pago === isPaid);
                        console.log('[ADMIN] ‚úÖ Filtro status aplicado:', filteredSubscriptions.length, 'itens restantes');
                    }

                    if (daysFilter) {
                        const now = new Date();
                        filteredSubscriptions = filteredSubscriptions.filter(salon => {
                            if (!salon.data_vencimento_mensalidade) return false;
                            const dueDate = new Date(salon.data_vencimento_mensalidade);
                            const diffTime = dueDate - now;
                            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                            switch(daysFilter) {
                                case '7': return diffDays >= 0 && diffDays <= 7;
                                case '30': return diffDays >= 0 && diffDays <= 30;
                                case 'expired': return diffDays < 0;
                                default: return true;
                            }
                        });
                        console.log('[ADMIN] ‚úÖ Filtro dias aplicado:', filteredSubscriptions.length, 'itens restantes');
                    }

                    displaySubscriptionsList(filteredSubscriptions);
                } else {
                    console.log('[ADMIN] ‚ùå Falha na resposta da API para mensalidades:', response);
                    throw new Error('Erro ao carregar mensalidades');
                }
            } catch (error) {
                console.error('[ADMIN] ‚ùå Erro ao carregar mensalidades:', error);
                document.getElementById('subscriptionsList').innerHTML = '<div class="alert alert-error">Erro ao carregar mensalidades</div>';
            }
        }

        // Exibir lista de mensalidades
        function displaySubscriptionsList(subscriptions) {
            const container = document.getElementById('subscriptionsList');

            if (!subscriptions || subscriptions.length === 0) {
                container.innerHTML = '<p class="text-center">Nenhuma mensalidade encontrada com os filtros aplicados.</p>';
                return;
            }

            let html = '<div class="table-responsive"><table class="table">';
            html += '<thead><tr><th>Sal√£o</th><th>Status</th><th>Vencimento</th><th>Dias Restantes</th><th>A√ß√µes</th></tr></thead>';
            html += '<tbody>';

            subscriptions.forEach(salon => {
                const paymentClass = salon.mensalidade_pago ? 'badge-success' : 'badge-danger';
                const paymentText = salon.mensalidade_pago ? 'Pago' : 'Pendente';
                const dueDate = salon.data_vencimento_mensalidade ?
                    new Date(salon.data_vencimento_mensalidade).toLocaleDateString('pt-BR') : 'N/A';

                // Calcular dias restantes
                let daysRemaining = 'N/A';
                let daysClass = '';
                if (salon.data_vencimento_mensalidade) {
                    const now = new Date();
                    const due = new Date(salon.data_vencimento_mensalidade);
                    const diffTime = due - now;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                    if (diffDays < 0) {
                        daysRemaining = `${Math.abs(diffDays)} dias atraso`;
                        daysClass = 'text-danger';
                    } else if (diffDays === 0) {
                        daysRemaining = 'Vence hoje';
                        daysClass = 'text-warning';
                    } else {
                        daysRemaining = `${diffDays} dias`;
                        daysClass = diffDays <= 7 ? 'text-warning' : '';
                    }
                }

                html += `
                    <tr>
                        <td>${salon.nome}</td>
                        <td><span class="badge ${paymentClass}">${paymentText}</span></td>
                        <td>${dueDate}</td>
                        <td class="${daysClass}">${daysRemaining}</td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="manageSubscription(${salon.id}, '${salon.nome}')">
                                Gerenciar
                            </button>
                        </td>
                    </tr>
                `;
            });

            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        // ============ GERENCIAMENTO DE DONOS ============

        // Carregar lista de donos
        async function loadOwners() {
            try {
                console.log('[ADMIN] üîÑ Carregando lista de donos...');
                UI.showLoading(document.getElementById('ownersList'));

                const response = await api.request('/salons/admin/owners');
                console.log('[ADMIN] üìä Resposta da API para donos:', response);
                if (response.success) {
                    console.log('[ADMIN] ‚úÖ Donos carregados:', response.owners.length, 'itens');
                    console.log('[ADMIN] üìã Dados dos donos:', response.owners);
                    // DEBUG: Verificar se os campos est√£o presentes
                    if (response.owners && response.owners.length > 0) {
                        const firstOwner = response.owners[0];
                        console.log('[ADMIN] üîç Primeiro dono - campos dispon√≠veis:', Object.keys(firstOwner));
                        console.log('[ADMIN] üîç Primeiro dono - valores:', firstOwner);
                    }
                    displayOwnersList(response.owners);
                } else {
                    console.log('[ADMIN] ‚ùå Falha na resposta da API para donos:', response);
                    throw new Error('Erro ao carregar donos');
                }
            } catch (error) {
                console.error('[ADMIN] ‚ùå Erro ao carregar donos:', error);
                document.getElementById('ownersList').innerHTML = '<div class="alert alert-error">Erro ao carregar donos</div>';
            }
        }

        // Exibir lista de donos
        function displayOwnersList(owners) {
            const container = document.getElementById('ownersList');

            if (!owners || owners.length === 0) {
                container.innerHTML = '<p class="text-center">Nenhum dono cadastrado.</p>';
                return;
            }

            let html = '<div class="table-responsive"><table class="table">';
            html += '<thead><tr><th>Nome</th><th>Email</th><th>Status</th><th>Criado em</th><th>Criado por</th></tr></thead>';
            html += '<tbody>';

            owners.forEach(owner => {
                const statusClass = owner.ativo ? 'badge-success' : 'badge-danger';
                const statusText = owner.ativo ? 'Ativo' : 'Inativo';
                const createdDate = owner.criado_em ? new Date(owner.criado_em).toLocaleDateString('pt-BR') : 'N/A';
                const createdBy = owner.criado_por ? `Admin ${owner.criado_por}` : 'Sistema';

                html += `
                    <tr>
                        <td>${owner.nome}</td>
                        <td>${owner.email}</td>
                        <td><span class="badge ${statusClass}">${statusText}</span></td>
                        <td>${createdDate}</td>
                        <td>${createdBy}</td>
                    </tr>
                `;
            });

            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        // Abrir modal para criar dono
        function openOwnerModal() {
            document.getElementById('ownerModalTitle').textContent = 'Criar Novo Dono';
            document.getElementById('ownerForm').reset();
            document.getElementById('ownerModal').classList.add('show');
            document.getElementById('ownerName').focus();
        }

        // Fechar modal de dono
        function closeOwnerModal() {
            document.getElementById('ownerModal').classList.remove('show');
        }

        // Processar cria√ß√£o de dono
        async function handleOwnerSubmit(event) {
            event.preventDefault();

            const ownerData = {
                nome: document.getElementById('ownerName').value.trim(),
                email: document.getElementById('ownerEmail').value.trim()
            };

            // Valida√ß√µes
            if (!ownerData.nome) {
                UI.showError('Nome do dono √© obrigat√≥rio');
                document.getElementById('ownerName').focus();
                return;
            }

            if (!ownerData.email) {
                UI.showError('Email do dono √© obrigat√≥rio');
                document.getElementById('ownerEmail').focus();
                return;
            }

            try {
                // Desabilitar bot√£o
                const submitBtn = event.target.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = 'Criando...';
                submitBtn.disabled = true;

                console.log('[DASHBOARD] üîÑ Iniciando cria√ß√£o de dono:', ownerData);

                // Usar o sistema de atualiza√ß√£o em tempo real
                const result = await window.DashboardRealtime.performDataOperation(async () => {
                    return await api.request('/auth/admin/create-owner', {
                        method: 'POST',
                        body: JSON.stringify(ownerData)
                    });
                }, {
                    refresh: true // Refresh completo ap√≥s criar dono
                });

                if (result.success) {
                    console.log('[DASHBOARD] ‚úÖ Dono criado com sucesso');
                    UI.showSuccess(`Dono "${ownerData.nome}" criado com sucesso! Credenciais enviadas para ${ownerData.email}`);
                    closeOwnerModal();
                } else {
                    console.log('[DASHBOARD] ‚ùå Erro na resposta da API:', result);
                    throw new Error(result.message || 'Erro ao criar dono');
                }

            } catch (error) {
                console.error('[DASHBOARD] ‚ùå Erro ao criar dono:', error);
                UI.showError(error.message || 'Erro ao criar dono');
            } finally {
                // Reabilitar bot√£o
                const submitBtn = event.target.querySelector('button[type="submit"]');
                submitBtn.textContent = 'Criar Dono';
                submitBtn.disabled = false;
            }
        }

        // Abrir modal de cria√ß√£o de sal√£o
        function openSalonModal(salon = null) {
            const modal = document.getElementById('salonModal');
            const form = document.getElementById('salonForm');
            const title = document.getElementById('salonModalTitle');

            if (salon) {
                title.textContent = 'Editar Sal√£o';
                document.getElementById('salonName').value = salon.nome;
                document.getElementById('salonEmail').value = salon.email;
                currentSalonId = salon.id;
            } else {
                title.textContent = 'Criar Novo Sal√£o';
                form.reset();
                currentSalonId = null;
            }

            modal.classList.add('show');
        }

        // Fechar modal de sal√£o
        function closeSalonModal() {
            document.getElementById('salonModal').classList.remove('show');
            currentSalonId = null;
        }

        // Processar cria√ß√£o/edi√ß√£o de sal√£o
        async function handleSalonSubmit(event) {
            event.preventDefault();

            const name = document.getElementById('salonName').value.trim();
            const email = document.getElementById('salonEmail').value.trim();

            if (!name) {
                UI.showError('Nome do sal√£o √© obrigat√≥rio');
                return;
            }

            try {
                console.log('[DASHBOARD] üîÑ Iniciando cria√ß√£o de sal√£o:', name);

                const salonData = {
                    nome: name,
                    email: email || undefined
                };

                // Usar o sistema de atualiza√ß√£o em tempo real
                const result = await window.DashboardRealtime.performDataOperation(async () => {
                    return await api.request('/salons/admin/create', {
                        method: 'POST',
                        body: JSON.stringify(salonData)
                    });
                }, {
                    refresh: true // Refresh completo ap√≥s criar sal√£o
                });

                if (result.success) {
                    console.log('[DASHBOARD] ‚úÖ Sal√£o criado com sucesso');
                    UI.showSuccess('Sal√£o criado com sucesso!');
                    closeSalonModal();
                } else {
                    console.log('[DASHBOARD] ‚ùå Erro na resposta da API:', result);
                    UI.showError(result.error || 'Erro ao criar sal√£o');
                }
            } catch (error) {
                console.error('[DASHBOARD] ‚ùå Erro ao criar sal√£o:', error);
                UI.showError('Erro ao criar sal√£o');
            }
        }

        // Abrir modal de gest√£o de mensalidade
        function manageSubscription(salonId, salonName) {
            currentSalonId = salonId;
            document.getElementById('subscriptionSalonName').textContent = salonName;

            // Definir data padr√£o (30 dias a partir de hoje)
            const today = new Date();
            const nextMonth = new Date(today);
            nextMonth.setDate(today.getDate() + 30);
            document.getElementById('dueDate').value = nextMonth.toISOString().split('T')[0];

            document.getElementById('subscriptionModal').classList.add('show');
        }

        // Fechar modal de mensalidade
        function closeSubscriptionModal() {
            document.getElementById('subscriptionModal').classList.remove('show');
            currentSalonId = null;
        }

        // Processar atualiza√ß√£o de mensalidade
        async function handleSubscriptionSubmit(event) {
            event.preventDefault();

            const paymentStatus = document.getElementById('paymentStatus').value === 'true';
            const dueDate = document.getElementById('dueDate').value;

            if (!dueDate) {
                UI.showError('Data de vencimento √© obrigat√≥ria');
                return;
            }

            try {
                console.log('[DASHBOARD] üîÑ Iniciando atualiza√ß√£o de mensalidade para sal√£o:', currentSalonId);

                // Usar o sistema de atualiza√ß√£o em tempo real
                const result = await window.DashboardRealtime.performDataOperation(async () => {
                    return await api.request(`/salons/admin/${currentSalonId}/subscription`, {
                        method: 'PUT',
                        body: JSON.stringify({
                            mensalidade_pago: paymentStatus,
                            data_vencimento: dueDate
                        })
                    });
                }, {
                    refreshSalonId: currentSalonId // Atualiza apenas este sal√£o em todas as tabelas
                });

                if (result.success) {
                    console.log('[DASHBOARD] ‚úÖ Mensalidade atualizada com sucesso');
                    UI.showSuccess('Mensalidade atualizada com sucesso!');
                    closeSubscriptionModal();
                } else {
                    console.log('[DASHBOARD] ‚ùå Erro na resposta da API:', result);
                    UI.showError(result.error || 'Erro ao atualizar mensalidade');
                }
            } catch (error) {
                console.error('[DASHBOARD] ‚ùå Erro ao atualizar mensalidade:', error);
                UI.showError('Erro ao atualizar mensalidade');
            }
        }


        // Limpar filtros de mensalidade
        function clearSubscriptionFilters() {
            document.getElementById('subscriptionFilter').value = '';
            document.getElementById('daysFilter').value = '';
            loadSubscriptions();
        }

        // Gerar relat√≥rio de crescimento
        async function generateGrowthReport() {
            const period = document.getElementById('growthPeriod').value;
            const resultDiv = document.getElementById('growthReportResult');

            try {
                // Simula√ß√£o - em produ√ß√£o, implementar endpoint real
                resultDiv.innerHTML = `
                    <div class="alert alert-info">
                        <h4>Relat√≥rio de Crescimento - ${period === 'monthly' ? 'Mensal' : period === 'quarterly' ? 'Trimestral' : 'Anual'}</h4>
                        <p>Novos sal√µes: 5</p>
                        <p>Taxa de crescimento: 25%</p>
                        <p>Proje√ß√£o para pr√≥ximo per√≠odo: 8 sal√µes</p>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = '<div class="alert alert-error">Erro ao gerar relat√≥rio</div>';
            }
        }

        // Gerar relat√≥rio de receita
        async function generateRevenueReport() {
            const period = document.getElementById('revenuePeriod').value;
            const resultDiv = document.getElementById('revenueReportResult');

            try {
                // Simula√ß√£o - em produ√ß√£o, implementar endpoint real
                resultDiv.innerHTML = `
                    <div class="alert alert-info">
                        <h4>Relat√≥rio de Receita - ${period === 'monthly' ? 'Mensal' : period === 'quarterly' ? 'Trimestral' : 'Anual'}</h4>
                        <p>Receita total: R$ 4.950,00</p>
                        <p>Mensalidades ativas: 50</p>
                        <p>Taxa de inadimpl√™ncia: 10%</p>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = '<div class="alert alert-error">Erro ao gerar relat√≥rio</div>';
            }
        }

        // Fun√ß√£o global para manageSubscription (acess√≠vel via onclick)
        window.manageSubscription = manageSubscription;

        // ============ CONFIGURA√á√ïES DA EMPRESA (ADMIN) ============

        // Inicializar aba de configura√ß√µes da empresa
        function initializeCompanySettings() {
            console.log('[COMPANY-ADMIN] Inicializando configura√ß√µes da empresa...');

            // Aguardar um pouco para garantir que o DOM est√° pronto
            setTimeout(() => {
                // Verificar se a aba pai est√° vis√≠vel primeiro
                const companySettingsTab = document.getElementById('companySettingsTab');
                if (!companySettingsTab) {
                    console.error('[COMPANY-ADMIN] Aba companySettingsTab n√£o encontrada');
                    return;
                }

                const tabComputedStyle = window.getComputedStyle(companySettingsTab);
                console.log('[COMPANY-ADMIN] Status da aba pai - display:', tabComputedStyle.display, 'visibility:', tabComputedStyle.visibility);

                if (tabComputedStyle.display === 'none') {
                    console.warn('[COMPANY-ADMIN] Aba pai est√° oculta, tentando for√ßar visibilidade');
                    companySettingsTab.style.setProperty('display', 'block', 'important');
                    companySettingsTab.classList.add('active');
                }

                // Verificar se elementos existem
                const companySearch = document.getElementById('companySearch');
                const companiesList = document.getElementById('companiesList');
                const companySettingsContent = document.getElementById('companySettingsContent');

                console.log('[COMPANY-ADMIN] Elementos encontrados:', {
                    companySettingsTab: !!companySettingsTab,
                    companySearch: !!companySearch,
                    companiesList: !!companiesList,
                    companySettingsContent: !!companySettingsContent
                });

                // Reset state
                selectedCompanyId = null;
                selectedCompanyData = null;

                if (companySettingsContent) {
                    companySettingsContent.style.display = 'none';
                }
                if (companySearch) {
                    companySearch.value = '';
                }
                if (companiesList) {
                    companiesList.style.display = 'none';
                    companiesList.innerHTML = '';
                }

                // Garantir que os campos de busca estejam sempre vis√≠veis
                const searchContainer = document.querySelector('#companySettingsTab .card');
                if (searchContainer) {
                    // For√ßar visibilidade com estilos inline diretos
                    searchContainer.style.setProperty('display', 'block', 'important');
                    searchContainer.style.setProperty('visibility', 'visible', 'important');
                    searchContainer.style.setProperty('opacity', '1', 'important');
                    console.log('[COMPANY-ADMIN] Estilos inline aplicados ao container de busca');

                    // Verificar se os elementos filhos tamb√©m est√£o vis√≠veis
                    const companySearch = document.getElementById('companySearch');
                    const searchBtn = document.getElementById('searchCompaniesBtn');

                    if (companySearch) {
                        companySearch.style.setProperty('display', 'inline-block', 'important');
                        companySearch.style.setProperty('visibility', 'visible', 'important');
                        companySearch.style.setProperty('opacity', '1', 'important');
                        console.log('[COMPANY-ADMIN] Estilos inline aplicados ao campo de busca');
                    }

                    if (searchBtn) {
                        searchBtn.style.setProperty('display', 'inline-block', 'important');
                        searchBtn.style.setProperty('visibility', 'visible', 'important');
                        searchBtn.style.setProperty('opacity', '1', 'important');
                        console.log('[COMPANY-ADMIN] Estilos inline aplicados ao bot√£o de busca');
                    }

                    // Verifica√ß√£o final com m√∫ltiplas tentativas
                    let attempts = 0;
                    const checkVisibility = () => {
                        attempts++;
                        const computedStyle = window.getComputedStyle(searchContainer);
                        console.log(`[COMPANY-ADMIN] Tentativa ${attempts} - Container computed display:`, computedStyle.display);

                        if (computedStyle.display === 'none' && attempts < 5) {
                            console.warn(`[COMPANY-ADMIN] Tentativa ${attempts} - Elemento ainda oculto, tentando novamente...`);
                            searchContainer.style.setProperty('display', 'block', 'important');
                            if (companySearch) companySearch.style.setProperty('display', 'inline-block', 'important');
                            if (searchBtn) searchBtn.style.setProperty('display', 'inline-block', 'important');
                            setTimeout(checkVisibility, 200);
                        } else if (attempts >= 5) {
                            console.error('[COMPANY-ADMIN] M√°ximo de tentativas atingido. Elemento pode estar sendo ocultado por CSS externo.');
                        }
                    };

                    setTimeout(checkVisibility, 100);

                } else {
                    console.error('[COMPANY-ADMIN] Container de busca n√£o encontrado');
                }
            }, 500); // Aguardar 500ms para garantir que o DOM est√° pronto
        }

        // Buscar empresas
        async function searchCompanies() {
            const searchTerm = document.getElementById('companySearch').value.trim();
            const companiesList = document.getElementById('companiesList');

            if (!searchTerm) {
                companiesList.style.display = 'none';
                return;
            }

            try {
                console.log('[COMPANY-ADMIN] Buscando empresas com termo:', searchTerm);
                const response = await api.request('/salons/admin/subscriptions');
                if (response.success) {
                    const filteredCompanies = response.subscriptions.filter(salon =>
                        salon.nome.toLowerCase().includes(searchTerm.toLowerCase())
                    );

                    displayCompaniesList(filteredCompanies);
                } else {
                    console.error('[COMPANY-ADMIN] Erro ao buscar empresas:', response);
                    UI.showError('Erro ao buscar empresas');
                }
            } catch (error) {
                console.error('[COMPANY-ADMIN] Erro na busca:', error);
                UI.showError('Erro ao buscar empresas');
            }
        }

        // Exibir lista de empresas
        function displayCompaniesList(companies) {
            const companiesList = document.getElementById('companiesList');

            if (companies.length === 0) {
                companiesList.innerHTML = '<div class="p-2 text-muted">Nenhuma empresa encontrada</div>';
                companiesList.style.display = 'block';
                return;
            }

            let html = '';
            companies.forEach(company => {
                const statusClass = company.ativo ? 'badge-success' : 'badge-danger';
                const statusText = company.ativo ? 'Ativo' : 'Inativo';
                html += `
                    <div class="company-item p-2 border-bottom" style="cursor: pointer;" onclick="selectCompany(${company.id}, '${company.nome.replace(/'/g, "\\'")}')">
                        <div class="d-flex justify-between align-center">
                            <div>
                                <strong>${company.nome}</strong>
                                <br>
                                <small class="text-muted">${company.email}</small>
                            </div>
                            <span class="badge ${statusClass}">${statusText}</span>
                        </div>
                    </div>
                `;
            });

            companiesList.innerHTML = html;
            companiesList.style.display = 'block';
        }

        // Selecionar empresa
        async function selectCompany(companyId, companyName) {
            console.log('[COMPANY-ADMIN] Selecionando empresa:', companyId, companyName);
            selectedCompanyId = companyId;

            // Esconder lista de empresas
            document.getElementById('companiesList').style.display = 'none';
            document.getElementById('companySearch').value = companyName;

            // Mostrar conte√∫do das configura√ß√µes
            document.getElementById('companySettingsContent').style.display = 'block';

            // Carregar dados da empresa
            await loadAdminCompanyData();

            UI.showSuccess(`Empresa "${companyName}" selecionada`);
        }

        // Carregar dados da empresa selecionada
        async function loadAdminCompanyData() {
            if (!selectedCompanyId) return;

            try {
                console.log('[COMPANY-ADMIN] Carregando dados da empresa:', selectedCompanyId);
                // Usar rota espec√≠fica para admin acessar dados de qualquer empresa
                const response = await api.request(`/salons/admin/company/${selectedCompanyId}/details`);
                if (response) {
                    selectedCompanyData = response;
                    console.log('[COMPANY-ADMIN] Dados carregados:', response);

                    // Carregar sub-aba ativa
                    const activeSubTab = document.querySelector('.company-sub-tab-btn.active');
                    if (activeSubTab) {
                        switchCompanySubTab(activeSubTab.dataset.subTab);
                    }
                } else {
                    UI.showError('Erro ao carregar dados da empresa');
                }
            } catch (error) {
                console.error('[COMPANY-ADMIN] Erro ao carregar dados:', error);
                UI.showError('Erro ao carregar dados da empresa');
            }
        }

        // Alternar sub-abas da empresa
        function switchCompanySubTab(subTabName) {
            console.log(`[COMPANY-ADMIN] Trocando para sub-aba: ${subTabName}`);

            // Atualizar bot√µes
            document.querySelectorAll('.company-sub-tab-btn').forEach(btn => {
                btn.className = btn.dataset.subTab === subTabName ?
                    'btn btn-primary company-sub-tab-btn active' :
                    'btn btn-outline company-sub-tab-btn';
            });

            // Mostrar/ocultar conte√∫do
            document.querySelectorAll('.company-sub-tab-content').forEach(content => {
                content.classList.remove('active');
                content.style.display = 'none';
            });

            const targetContent = document.getElementById(subTabName + 'SubTab');
            if (targetContent) {
                targetContent.style.display = 'block';
                targetContent.classList.add('active');

                // Carregar dados da sub-aba
                switch(subTabName) {
                    case 'basic-info':
                        loadAdminCompanyBasic();
                        break;
                    case 'appearance':
                        loadAdminCompanyAppearance();
                        break;
                    case 'owner-info':
                        loadAdminCompanyOwner();
                        break;
                    case 'sharing':
                        loadAdminCompanySharing();
                        break;
                }
            }
        }

        // ============ INFORMA√á√ïES B√ÅSICAS (ADMIN) ============

        async function loadAdminCompanyBasic() {
            if (!selectedCompanyData) return;

            console.log('[COMPANY-ADMIN] Carregando informa√ß√µes b√°sicas...');

            document.getElementById('adminCompanyName').value = selectedCompanyData.nome || '';
            document.getElementById('adminCompanyPhone').value = selectedCompanyData.telefone || '';

            // Quebrar endere√ßo
            const endereco = selectedCompanyData.endereco || '';
            const enderecoParts = parseEndereco(endereco);
            document.getElementById('adminCompanyStreet').value = enderecoParts.rua || '';
            document.getElementById('adminCompanyNeighborhood').value = enderecoParts.bairro || '';

            document.getElementById('adminCompanyDescription').value = selectedCompanyData.descricao || '';

            showAdminCompanyMessage('Dados b√°sicos carregados!', 'success');
        }

        async function handleAdminCompanyBasicSubmit(event) {
            event.preventDefault();
            if (!selectedCompanyId) return;

            try {
                const rua = document.getElementById('adminCompanyStreet').value.trim();
                const bairro = document.getElementById('adminCompanyNeighborhood').value.trim();
                const enderecoCompleto = buildEndereco(rua, bairro);

                const data = {
                    nome: document.getElementById('adminCompanyName').value.trim(),
                    telefone: document.getElementById('adminCompanyPhone').value.trim(),
                    endereco: enderecoCompleto,
                    descricao: document.getElementById('adminCompanyDescription').value.trim()
                };

                if (!data.nome) {
                    showAdminCompanyMessage('Nome da empresa √© obrigat√≥rio.', 'error');
                    return;
                }

                console.log('[COMPANY-ADMIN] Salvando informa√ß√µes b√°sicas:', data);
                // Usar rota espec√≠fica para admin atualizar dados b√°sicos
                const result = await api.request(`/salons/admin/company/${selectedCompanyId}/basic-info`, {
                    method: 'PUT',
                    body: JSON.stringify(data)
                });

                if (result.success) {
                    // Atualizar dados locais
                    selectedCompanyData = { ...selectedCompanyData, ...data };
                    showAdminCompanyMessage('Informa√ß√µes b√°sicas salvas com sucesso!', 'success');
                } else {
                    showAdminCompanyMessage('Erro ao salvar informa√ß√µes b√°sicas.', 'error');
                }
            } catch (error) {
                console.error('[COMPANY-ADMIN] Erro ao salvar:', error);
                showAdminCompanyMessage('Erro ao salvar informa√ß√µes b√°sicas.', 'error');
            }
        }

        // ============ APAR√äNCIA (ADMIN) ============

        async function loadAdminCompanyAppearance() {
            if (!selectedCompanyData) return;

            console.log('[COMPANY-ADMIN] Carregando apar√™ncia...');

            // Nome no card
            document.getElementById('adminCardDisplayName').value = selectedCompanyData.card_display_name || selectedCompanyData.nome || '';

            // Localiza√ß√£o
            updateAdminCardLocationFromBasic();

            // Descri√ß√£o do card
            document.getElementById('adminCardDescription').value = selectedCompanyData.card_description || selectedCompanyData.descricao || '';

            // Logo
            const logoUrl = selectedCompanyData.card_logo || selectedCompanyData.logo;
            if (logoUrl) {
                document.getElementById('adminLogoImage').src = logoUrl;
                document.getElementById('adminLogoPreview').style.display = 'block';
                window.uploadedLogoUrl = logoUrl;
            } else {
                document.getElementById('adminLogoPreview').style.display = 'none';
                window.uploadedLogoUrl = null;
            }

            // Atualizar preview
            updateAdminCardPreview();

            showAdminCompanyMessage('Apar√™ncia carregada!', 'success');
        }

        async function handleAdminCompanyAppearanceSubmit(event) {
            event.preventDefault();
            if (!selectedCompanyId) return;

            try {
                const data = {
                    cardDisplayName: document.getElementById('adminCardDisplayName').value.trim(),
                    cardLocation: document.getElementById('adminCardLocation').value.trim(),
                    cardDescription: document.getElementById('adminCardDescription').value.trim()
                };

                if (!data.cardDisplayName) {
                    showAdminCompanyMessage('Nome no card √© obrigat√≥rio.', 'error');
                    return;
                }

                console.log('[COMPANY-ADMIN] Salvando apar√™ncia:', data);
                // Usar rota espec√≠fica para admin atualizar apar√™ncia
                const result = await api.request(`/salons/admin/company/${selectedCompanyId}/appearance`, {
                    method: 'PUT',
                    body: JSON.stringify(data)
                });

                if (result.success) {
                    selectedCompanyData = { ...selectedCompanyData, ...data };
                    updateAdminCardPreview();
                    showAdminCompanyMessage('Apar√™ncia salva com sucesso!', 'success');
                } else {
                    showAdminCompanyMessage('Erro ao salvar apar√™ncia.', 'error');
                }
            } catch (error) {
                console.error('[COMPANY-ADMIN] Erro ao salvar apar√™ncia:', error);
                showAdminCompanyMessage('Erro ao salvar apar√™ncia.', 'error');
            }
        }

        function handleAdminLogoPreview(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('adminLogoImage').src = e.target.result;
                    document.getElementById('adminLogoPreview').style.display = 'block';
                    document.getElementById('adminUploadLogo').disabled = false;
                };
                reader.readAsDataURL(file);
            }
        }

        async function handleAdminLogoUpload(event) {
            event.preventDefault();
            if (!selectedCompanyId) return;

            const fileInput = document.getElementById('adminCompanyLogo');
            const file = fileInput.files[0];

            if (!file) {
                UI.showError('Por favor, selecione um arquivo de logo primeiro.');
                return;
            }

            try {
                console.log('[COMPANY-ADMIN] Fazendo upload do logo...');

                const formData = new FormData();
                formData.append('file', file);

                // Usar rota espec√≠fica para admin fazer upload de logo
                const response = await fetch(`${API_CONFIG.BASE_URL}/salons/admin/company/${selectedCompanyId}/upload-logo`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${TokenManager.get()}`
                    },
                    body: formData
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log('[COMPANY-ADMIN] Upload bem-sucedido:', result);

                    document.getElementById('adminLogoImage').src = result.logo_url;
                    document.getElementById('adminLogoPreview').style.display = 'block';
                    window.uploadedLogoUrl = result.logo_url;

                    // Atualizar dados locais
                    selectedCompanyData.logo = result.logo_url;

                    UI.showSuccess('Logo atualizado com sucesso!');
                    updateAdminCardPreview();
                } else {
                    const errorData = await response.json().catch(() => ({}));
                    UI.showError(errorData.detail || 'Erro ao fazer upload do logo.');
                }
            } catch (error) {
                console.error('[COMPANY-ADMIN] Erro no upload:', error);
                UI.showError('Erro ao fazer upload do logo.');
            }
        }

        // ============ INFORMA√á√ïES DO DONO (ADMIN) ============

        async function loadAdminCompanyOwner() {
            if (!selectedCompanyData) return;

            console.log('[COMPANY-ADMIN] Carregando informa√ß√µes do dono...');
            console.log('[COMPANY-ADMIN] Dados da empresa selecionada:', selectedCompanyData);

            // Os dados do dono j√° est√£o dispon√≠veis em selectedCompanyData
            // A rota /salons/admin/company/{salon_id}/details retorna os dados completos da empresa
            // Agora usamos campos separados: nome (empresa) e nome_dono (pessoa respons√°vel)
            document.getElementById('adminOwnerName').value = selectedCompanyData.nome_dono || selectedCompanyData.nome || '';
            document.getElementById('adminOwnerEmail').value = selectedCompanyData.email || '';
            document.getElementById('adminOwnerPersonalPhone').value = selectedCompanyData.telefone || '';
            // Nota: o campo 'experiencia' n√£o est√° sendo retornado pela API ainda
            // document.getElementById('adminOwnerExperience').value = selectedCompanyData.experiencia || '';

            console.log('[COMPANY-ADMIN] Campos preenchidos:', {
                nome_dono: selectedCompanyData.nome_dono,
                nome_empresa: selectedCompanyData.nome,
                email: selectedCompanyData.email,
                telefone: selectedCompanyData.telefone
            });

            showAdminCompanyMessage('Informa√ß√µes do dono carregadas!', 'success');
        }

        async function handleAdminCompanyOwnerSubmit(event) {
            event.preventDefault();
            if (!selectedCompanyId) return;

            try {
                const ownerNameValue = document.getElementById('adminOwnerName').value.trim();
                console.log('[COMPANY-ADMIN] Valor do campo nome do dono:', ownerNameValue);

                const data = {
                    owner_name: ownerNameValue,
                    email: document.getElementById('adminOwnerEmail').value.trim(),
                    telefone: document.getElementById('adminOwnerPersonalPhone').value.trim(),
                    experiencia: document.getElementById('adminOwnerExperience').value.trim()
                };

                console.log('[COMPANY-ADMIN] Dados a serem enviados:', data);

                // Nome do dono √© obrigat√≥rio apenas se o usu√°rio digitou algo
                // Se o campo ficou vazio, significa que n√£o foi alterado
                const ownerNameField = document.getElementById('adminOwnerName');
                const wasFieldModified = ownerNameField.value.trim() !== (selectedCompanyData.nome_dono || '');

                if (wasFieldModified && !data.owner_name.trim()) {
                    showAdminCompanyMessage('Nome do dono √© obrigat√≥rio quando preenchido.', 'error');
                    return;
                }

                console.log('[COMPANY-ADMIN] Salvando informa√ß√µes do dono:', data);
                // Usar rota espec√≠fica para admin atualizar informa√ß√µes do dono
                const result = await api.request(`/salons/admin/company/${selectedCompanyId}/owner-info`, {
                    method: 'PUT',
                    body: JSON.stringify(data)
                });

                if (result.success) {
                    // Atualizar dados locais com as informa√ß√µes do dono
                    selectedCompanyData.nome_dono = data.owner_name;
                    selectedCompanyData.email = data.email;
                    selectedCompanyData.telefone = data.telefone;
                    showAdminCompanyMessage('Informa√ß√µes do dono salvas com sucesso!', 'success');
                } else {
                    showAdminCompanyMessage('Erro ao salvar informa√ß√µes do dono.', 'error');
                }
            } catch (error) {
                console.error('[COMPANY-ADMIN] Erro ao salvar dono:', error);
                showAdminCompanyMessage('Erro ao salvar informa√ß√µes do dono.', 'error');
            }
        }

        // ============ COMPARTILHAMENTO (ADMIN) ============

        async function loadAdminCompanySharing() {
            if (!selectedCompanyId) return;

            console.log('[COMPANY-ADMIN] Carregando compartilhamento...');

            const baseUrl = window.location.origin;
            const shareLink = `${baseUrl}/salon-selection.html?salon=${selectedCompanyId}`;
            document.getElementById('adminCompanyShareLink').value = shareLink;

            showAdminCompanyMessage('Link de compartilhamento gerado!', 'success');
        }

        async function copyAdminShareLink() {
            const linkInput = document.getElementById('adminCompanyShareLink');
            const link = linkInput.value;

            if (!link) {
                showAdminCompanyMessage('Link n√£o dispon√≠vel para copiar.', 'warning');
                return;
            }

            try {
                await navigator.clipboard.writeText(link);
                showAdminCompanyMessage('Link copiado para a √°rea de transfer√™ncia!', 'success');

                // Feedback visual
                const copyBtn = document.getElementById('adminCopyShareLink');
                const originalText = copyBtn.textContent;
                copyBtn.textContent = '‚úÖ Copiado!';
                copyBtn.classList.add('btn-success');

                setTimeout(() => {
                    copyBtn.textContent = originalText;
                    copyBtn.classList.remove('btn-success');
                }, 2000);

            } catch (error) {
                console.error('[COMPANY-ADMIN] Erro ao copiar link:', error);
                showAdminCompanyMessage('Erro ao copiar link. Copie manualmente.', 'error');
            }
        }

        // ============ UTILIT√ÅRIOS (ADMIN) ============

        function updateAdminCardLocationFromBasic() {
            const bairro = document.getElementById('adminCompanyNeighborhood').value.trim();
            document.getElementById('adminCardLocation').value = bairro;
        }

        function updateAdminCardPreview() {
            const previewContainer = document.getElementById('adminCardPreview');

            const data = {
                nome: document.getElementById('adminCardDisplayName').value,
                endereco: document.getElementById('adminCardLocation').value,
                descricao: document.getElementById('adminCardDescription').value,
                logo: window.uploadedLogoUrl || selectedCompanyData?.logo
            };

            const previewHtml = `
                <div class="salon-card">
                    <div class="salon-card-header">
                        ${data.logo ? `<img src="${data.logo}" alt="Logo" class="salon-logo">` : '<div class="salon-logo-placeholder">üì∑</div>'}
                        <div class="salon-info">
                            <h3 class="salon-name">${data.nome || 'Nome do Sal√£o'}</h3>
                            <p class="salon-location">üìç ${data.endereco || 'Localiza√ß√£o'}</p>
                        </div>
                    </div>
                    <div class="salon-card-body">
                        ${data.descricao ? `<p class="salon-description">${data.descricao}</p>` : ''}
                        <div class="salon-owner">
                            <small>üë§ Dono: ${selectedCompanyData?.nome || 'Nome do Dono'}</small>
                        </div>
                    </div>
                    <div class="salon-card-footer">
                        <button class="btn btn-primary" disabled>Agendar Servi√ßo</button>
                    </div>
                </div>
            `;

            previewContainer.innerHTML = previewHtml;
        }

        function showAdminCompanyMessage(message, type) {
            const messages = document.getElementById('adminCompanyProfileMessages');

            if (!messages) {
                console.warn('Container de mensagens da empresa n√£o encontrado');
                return;
            }

            const alertClass = type === 'error' ? 'alert-error' :
                              type === 'success' ? 'alert-success' :
                              type === 'warning' ? 'alert-warning' : 'alert-info';

            messages.innerHTML = `
                <div class="alert ${alertClass}" style="margin-top: 1rem;">
                    ${message}
                </div>
            `;

            if (type === 'success') {
                setTimeout(() => {
                    if (messages) messages.innerHTML = '';
                }, 5000);
            }
        }

        // Fun√ß√µes utilit√°rias (reutilizadas do dashboard dono)
        function parseEndereco(enderecoCompleto) {
            if (!enderecoCompleto) return { rua: '', bairro: '' };

            const parts = enderecoCompleto.split(' - ');
            if (parts.length >= 2) {
                return {
                    rua: parts[0].trim(),
                    bairro: parts.slice(1).join(' - ').trim()
                };
            }

            return {
                rua: enderecoCompleto.trim(),
                bairro: ''
            };
        }

        function buildEndereco(rua, bairro) {
            if (!rua && !bairro) return '';
            if (!rua) return bairro;
            if (!bairro) return rua;
            return `${rua} - ${bairro}`;
        }

        // Expor fun√ß√µes globalmente
        window.selectCompany = selectCompany;

        // Fun√ß√£o de teste para o sistema de atualiza√ß√£o em tempo real
        async function testRealtimeUpdate() {
            console.log('üß™ Iniciando teste do sistema de atualiza√ß√£o em tempo real...');

            try {
                // Simular uma opera√ß√£o que deveria atualizar o dashboard
                await window.DashboardRealtime.performDataOperation(async () => {
                    // Simular uma requisi√ß√£o bem-sucedida
                    return { success: true, message: 'Teste realizado com sucesso' };
                }, {
                    refresh: true // For√ßar atualiza√ß√£o completa
                });

                UI.showSuccess('‚úÖ Teste conclu√≠do! Verifique os logs do console para detalhes.');
                console.log('‚úÖ Teste do sistema de atualiza√ß√£o em tempo real conclu√≠do com sucesso!');

            } catch (error) {
                console.error('‚ùå Erro no teste:', error);
                UI.showError('Erro no teste do sistema');
            }
        }

        // Expor fun√ß√£o de teste globalmente
        window.testRealtimeUpdate = testRealtimeUpdate;
    </script>

    <style>
        /* Estilos para configura√ß√µes da empresa (Admin) */
        .company-item:hover {
            background-color: #f8f9fa;
        }

        .company-sub-tab-content { display: none; }
        .company-sub-tab-content.active { display: block; }
        .company-sub-tab-btn { margin: 0; }

        /* Garantir que os campos de busca estejam sempre vis√≠veis */
        #companySettingsTab .card {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        #companySearch, #searchCompaniesBtn {
            display: inline-block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        /* Classe para for√ßar visibilidade */
        .force-visible {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
    </style>
</body>

</html>